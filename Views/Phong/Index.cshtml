@model IEnumerable<QL_KhachSan.tblPhong>

@{
    ViewBag.Title = "Sơ Đồ Phòng";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>🏨 Sơ Đồ Phòng</h2>
    <a href="@Url.Action("Create", "Phong")" class="btn btn-success">+ Thêm Phòng Mới</a>
</div>

<div class="mb-4">
    <span class="badge bg-success me-2 p-2">Trống</span>
    <span class="badge bg-danger me-2 p-2">Đang có khách</span>
    <span class="badge bg-warning text-dark p-2">Đang dọn / Bảo trì</span>
</div>

<div class="row">
    @foreach (var item in Model)
    {
        // Xử lý màu sắc dựa trên trạng thái
        string cardClass = "bg-light";
        string textClass = "text-dark";
        string icon = "fa-door-open";

        if (item.TrangThai == "Đang ở")
        {
            cardClass = "bg-danger text-white";
            textClass = "text-white";
            icon = "fa-user-lock";
        }
        else if (item.TrangThai == "Trống")
        {
            cardClass = "bg-success text-white";
            textClass = "text-white";
        }
        else
        {
            cardClass = "bg-warning"; // Đang dọn
            icon = "fa-broom";
        }

        <div class="col-md-3 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm @cardClass">
                <div class="card-body text-center">
                    <h3 class="card-title fw-bold">P.@item.SoPhong</h3>
                    <p class="card-text mb-1"><i class="fas @icon"></i> @item.tblLoaiPhong.TenLoai</p>
                    <p class="small">Tầng: @item.Tang</p>

                    @* Hiển thị ảnh nếu có *@
                    @if (!string.IsNullOrEmpty(item.AnhDaiDien))
                    {
                        <img src="~/Content/Images/@item.AnhDaiDien" class="img-thumbnail mb-2" style="height: 100px; object-fit: cover; width: 100%;" />
                    }
                </div>
                <div class="card-footer bg-transparent border-0 text-center">
                    @if (item.TrangThai == "Trống")
                    {
                        // Nếu trống -> Hiện nút Check-in
                        // Truyền sẵn MaPhong sang trang đặt phòng
                        <a href="@Url.Action("Create", "HoaDon", new { MaPhong = item.MaPhong })" class="btn btn-light btn-sm text-success fw-bold">
                            <i class="fas fa-check"></i> Check-in
                        </a>
                    }
                    else if (item.TrangThai == "Đang ở")
                    {
                        // Logic tìm MaHD để thanh toán hơi phức tạp ở View,
                        // nên ta sẽ chuyển sang trang Danh sách Hóa đơn
                        <a href="@Url.Action("Index", "HoaDon")" class="btn btn-light btn-sm text-danger fw-bold">
                            <i class="fas fa-money-bill"></i> Thanh toán
                        </a>
                    }
                </div>
            </div>
        </div>
    }
</div>