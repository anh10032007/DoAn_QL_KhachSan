@model IEnumerable<QL_KhachSan.tblPhong>
@{
    ViewBag.Title = "Sơ Đồ Phòng";
    // Lấy quyền hiện tại: 1 = Admin, 2 = Nhân viên
    int vaiTro = 0;
    if (Session["VaiTro"] != null)
    {
        vaiTro = Convert.ToInt32(Session["VaiTro"]);
    }
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>🏨 Sơ Đồ Phòng</h2>

    @* --- CHỈ ADMIN MỚI THẤY NÚT THÊM --- *@
    @if (vaiTro == 1)
    {
        <a href="@Url.Action("Create", "Phong")" class="btn btn-success">
            <i class="fas fa-plus"></i> Thêm Phòng Mới
        </a>
    }
</div>

<div class="mb-4">
    <span class="badge bg-success me-2 p-2">Trống</span>
    <span class="badge bg-danger me-2 p-2">Đang có khách</span>
    <span class="badge bg-warning text-dark p-2">Đang dọn / Bảo trì</span>
</div>

<div class="row">
    @foreach (var item in Model)
    {
        string cardClass = "bg-light";
        string icon = "fa-door-open";

        if (item.TrangThai == "Đang ở")
        {
            cardClass = "bg-danger text-white";
            icon = "fa-user-lock";
        }
        else if (item.TrangThai == "Trống")
        {
            cardClass = "bg-success text-white";
        }
        else
        {
            cardClass = "bg-warning";
            icon = "fa-broom";
        }

        <div class="col-md-3 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm @cardClass">
                <div class="card-body text-center">
                    <h3 class="card-title fw-bold">P.@item.SoPhong</h3>
                    <p class="card-text mb-1"><i class="fas @icon"></i> @item.tblLoaiPhong.TenLoai</p>
                    <p class="small">Tầng: @item.Tang</p>

                    @if (!string.IsNullOrEmpty(item.AnhDaiDien))
                    {
                        <img src="~/Content/Images/@item.AnhDaiDien" class="img-thumbnail mb-2" style="height: 100px; object-fit: cover; width: 100%;" />
                    }
                </div>

                <div class="card-footer bg-white text-center">
                    <div class="mb-2">
                        @if (item.TrangThai == "Trống")
                        {
                            <a href="@Url.Action("Create", "HoaDon", new { MaPhong = item.MaPhong })" class="btn btn-success btn-sm w-100 fw-bold">Check-in</a>
                        }
                        else if (item.TrangThai == "Đang ở")
                        {
                            <div class="btn-group w-100">
                                <a href="@Url.Action("Index", "HoaDon")" class="btn btn-danger btn-sm fw-bold">T.Toán</a>
                                <a href="@Url.Action("ResetPhong", "Phong", new { id = item.MaPhong })" class="btn btn-outline-danger btn-sm" onclick="return confirm('Reset trạng thái?');"><i class="fas fa-sync"></i></a>
                            </div>
                        }
                    </div>

                    @if (vaiTro == 1)
                    {
                        <hr class="my-1 text-muted">
                        <div class="d-flex justify-content-center gap-2 mt-2">
                            <a href="@Url.Action("Edit", "Phong", new { id = item.MaPhong })" class="btn btn-outline-primary btn-sm border-0"><i class="fas fa-edit"></i> Sửa</a>

                            @if (item.TrangThai == "Trống")
                            {
                                <a href="@Url.Action("Delete", "Phong", new { id = item.MaPhong })" class="btn btn-outline-secondary btn-sm border-0"><i class="fas fa-trash-alt"></i> Xóa</a>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</div>